---
title: Assembly of the Genome in a Bottle HG004 sequencing data
author: Shaun Jackman
output:
  html_document:
    keep_md: true
---

```{r install-packages, eval=FALSE, echo=FALSE}
install.packages("dplyr")
install.packages("ggplot2")
install.packages("ggrepel")
install.packages("knitr")
install.packages("magrittr")
install.packages("readr")
install.packages("rmarkdown")
install.packages("tidyr")
```

```{r load-libraries, message=FALSE}
library(dplyr)
library(ggplot2)
library(ggrepel)
library(knitr)
library(magrittr)
library(readr)
library(tidyr)
```

```{r read-data}
assembly_data_orig <- read_tsv("assembly-stats.tsv")
aligned_data_orig <- read_tsv("samtobreak.tsv")
```

```{r tidy-data}
assembly_data <- assembly_data_orig %>%
  mutate(Directory = dirname(name), File = basename(name)) %>%
	separate(File, c("Species", "Stage", "Ext")) %>%
	select(-Ext)

aligned_data <- aligned_data_orig %>%
  mutate(Directory = dirname(File), File = basename(File)) %>%
	separate(File, c("Reference", "Species", "Stage", "Ext")) %>%
	select(-Reference, -Ext)

assemblers <- list(
  "abyss" = "ABySS 1.9.0 k=144 + Sealer",
  "bcalm" = "BCALM 2.0.0",
  "discovardenovo" = "DISCOVARdenovo 52488",
  "discovardenovo/abyss-scaffold" = "DISCOVARdenovo 52488 + ABySS-Scaffold 1.9.0", 
  "discovardenovo/besst" = "DISCOVARdenovo 52488 + BESST 2.2.4",
  "discovardenovo/links" = "DISCOVARdenovo 52488 + LINKS 1.6.1",
  "sga" = "SGA 0.10.14",
  "soapdenovo" = "SOAPdenovo 2.04",
  "bionano" = "ABySS 1.9.0 k=144 + BioNano 2.1.5063",
  "discovardenovo/bionano" = "DISCOVARdenovo 52488 + BioNano 2.1.5063",
  "discovardenovo/abyss-scaffold/bionano" = "DISCOVARdenovo 52488 + ABySS-Scaffold 1.9.0 + BioNano 2.1.5063", 
  "discovardenovo/besst/bionano" = "DISCOVARdenovo 52488 + BESST 2.2.4 + BioNano 2.1.5063",
  "discovardenovo/links/bionano" = "DISCOVARdenovo 52488 + LINKS 1.6.1 + BioNano 2.1.5063"
)

data <- left_join(aligned_data, assembly_data,
    by = c("Directory", "Species", "Stage")) %>%
	mutate(Directory = factor(Directory, unique(Directory)),
	  Stage = factor(Stage, unique(Stage)),
  	Name = factor(Directory, levels = names(assemblers), labels = assemblers))
```

# Plot scaffold NGA50 and total breakpoints
```{r plot-scaffold-NGA50-breakpoints}
ggplot(data) +
  aes(x = Total_breakpoints, y = Scaffold_NGA50 / 1e6, label = Name) +
  xlab("Total breakpoints") + ylab("Scaffold NGA50 (Mbp)") +
  geom_point(size = 3) +
  geom_text_repel() +
  scale_colour_brewer(name = NULL, palette = "Dark2") +
	theme_grey(28) +
	theme(legend.position = c(.35, .85)) +
  xlim(0, 4000)
```

# Table of assembly stats
```{r tabulate-assembly-stats}
kable(data)
```

# Table of assembly stats
```{r tabulate-aligned-stats}
kable(aligned_data)
```
